<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8" %>
<%@ page import="java.sql.*" %>
<%@ page import="com.database.dbconn" %>
<%@ page import="com.database.priority" %>

<%
    try {
        Connection conn = dbconn.getConnection();
        Statement st = conn.createStatement();

        String orderID = request.getParameter("order_id");
        String customerID = request.getParameter("customer_id");
        String customerName = request.getParameter("customer_name");
        String vehicleNo = request.getParameter("vehicle_no");
        String startTime = request.getParameter("start_time");
        String estimatedCompleted = request.getParameter("estimated_completed");
        String estimatedCost = request.getParameter("estimated_cost");
        String repairs = request.getParameter("repairs");
        
//         To calculate priority
   		
		int timeEstimated=Integer.parseInt(estimatedCompleted);
		int amount=Integer.parseInt(estimatedCost);
        priority order= new priority(timeEstimated,amount);
        
        int priorit=order.calculate_priority();

        String query = "INSERT INTO order_list ( customer_id, customer_name, vehicle_no, start_time, estimated_completed, estimated_cost, repairs,priority) " +
                "VALUES ( '" + customerID + "', '" + customerName + "', '" + vehicleNo + "', '" + startTime + "', '" + estimatedCompleted + "', '" + estimatedCost + "', '" + repairs + "','" + priorit + "')";

        st.executeUpdate(query);

        response.getWriter().println("<script>Data inserted successfully</script>");

        // Redirect to index.html
        response.sendRedirect("index.html");
    } catch (Exception e) {
        out.println(e);
    }
%>
