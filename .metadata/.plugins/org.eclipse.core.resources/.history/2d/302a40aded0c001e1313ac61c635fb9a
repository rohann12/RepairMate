<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>

<!DOCTYPE html>
<html>
<head>
  <title>Login Result</title>
  <link rel="stylesheet" href="../CSS/login.css">
</head>
<body>
<h1>Login Form</h1>
        <form method='POST' action='' id="loginForm" onsubmit="event.preventDefault();validation();">
            
                <label for='user-name'>Username</label>
                <input type='text' placeholder='&#xf007; Enter Username' name="user-name" id="user-name"><br>
                <span class="error-message" id="username-validation"></span>
                <span class='backend-error-message'>
                    <?=$error_msg?>
                </span>
                <label for='password'>Password</label>
                <input type='password' placeholder='&#xf084; Enter Password' name='password' id="password"><br>
                <span  class="error-message" id="password-validation"></span>
                <span class='backend-error-message'>
                    <?=$error_msg2?>
                </span>
                <button type='submit'>Login</button>
                <hr>
                <span style="text-align:center"><b>Don't have an account</b></span>
                <a href="registration.jsp"><button type="button">Create an account</button></a>
           
        </form>
        
<%@ page import="java.sql.*" %>
<%@ page import="com.database.dbconn" %>

<%
   String username = request.getParameter("user-name");
   String password = request.getParameter("password");

   try {
      // Establish a database connection
      try (Connection conn = dbconn.getConnection()) {
         // Prepare the SQL statement
         String query = "SELECT * FROM user WHERE user_name = ? AND password = ?";
         try (PreparedStatement statement = conn.prepareStatement(query)) {
            statement.setString(1, username);
            statement.setString(2, password);

            // Execute the query
            try (ResultSet resultSet = statement.executeQuery()) {
               if (resultSet.next()) {
                  // Valid login credentials, redirect to a success page
                  response.sendRedirect("Index.html");
               } else {
                  // Invalid login credentials, display an error message
                  out.println("<p>Invalid username or password.</p>");
               }
            }
         }
      }
   } catch (Exception e) {
      out.println(e);
   }
%>
