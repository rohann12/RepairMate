<%@ page import="java.sql.*"%>
<%@ page import="com.database.dbconn"%>

<%
String username = request.getParameter("user-name");
String password = request.getParameter("password");

Connection conn = null;
PreparedStatement statement = null;
ResultSet resultSet = null;

try {
	// Establish a database connection
	conn = dbconn.getConnection();

	// Create the SQL statement
	String query = "SELECT * FROM user WHERE user_name = ? AND password = ?";

	// Create a prepared statement
	statement = conn.prepareStatement(query);
	// Set the parameters
	statement.setString(1, username);
	statement.setString(2, password);

	// Execute the query
	resultSet = statement.executeQuery();

	if (resultSet.next()) {
		// Check the value of the is_admin column
		int isAdmin = resultSet.getInt("is_admin");

		// Start a session and store the user information
		HttpSession session = request.getSession();
		session.setAttribute("username", username);
		session.setAttribute("isAdmin", isAdmin == 1);

		// Redirect to admin dashboard or a different page for non-admin users
		if (isAdmin == 1) {
	response.sendRedirect("adminDash.jsp");
		} else {
	response.sendRedirect("index.jsp");
		}
	} else {
		// Invalid login credentials, display an error message
		out.println("<p>Invalid username or password.</p>");
	}
} catch (Exception e) {
	out.println(e);
} finally {
	// Close the database resources
	if (resultSet != null) {
		try {
	resultSet.close();
		} catch (SQLException e) {
	e.printStackTrace();
		}
	}
	if (statement != null) {
		try {
	statement.close();
		} catch (SQLException e) {
	e.printStackTrace();
		}
	}
	if (conn != null) {
		try {
	conn.close();
		} catch (SQLException e) {
	e.printStackTrace();
		}
	}
}
%>