<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8" %>
<%@ page import="java.sql.*" %>
<%@ page import="java.util.*"%>


<%@ page import="com.database.dbconn" %>

<%
		if(request.getMethod().equalsIgnoreCase("POST")) {
        String fullName = request.getParameter("full-name");
        String email = request.getParameter("email");
        String contact = request.getParameter("contact");
        String userName = request.getParameter("user-name");
        String password = request.getParameter("password");
        
        // Perform password hashing
        MessageDigest digest = MessageDigest.getInstance("SHA-256");
        byte[] hashBytes = digest.digest(password.getBytes("UTF-8"));
        String hashedPassword = Hex.encodeHexString(hashBytes);
        
        // Database operations
        Connection conn = dbconn.getConnection();
        PreparedStatement statement = null;
        ResultSet resultSet = null;
        
        try {
                        
            // Check if user already exists
            String checkUserQuery = "SELECT user_name FROM user_details WHERE user_name = ?";
            statement = conn.prepareStatement(checkUserQuery);
            statement.setString(1, userName);
            resultSet = statement.executeQuery();
            
            if (resultSet.next()) {
                String errorMessage = "User name already exists. Please try another.";
                // Handle error message accordingly
            } else {
                // Insert user details
                String createUserQuery = "INSERT INTO user_details (full_name, email, contact, user_name, password) VALUES (fullName,email,contact,userName,password)";
                statement = conn.prepareStatement(createUserQuery);
                statement.setString(1, fullName);
                statement.setString(2, email);
                statement.setString(3, contact);
                statement.setString(4, userName);
                statement.setString(5, hashedPassword);
                statement.executeUpdate();
                
                String successMessage = "User created successfully.";
                
                // Send email
                String senderEmail = "sender_email@example.com";
                String senderPassword = "sender_password";
                String recipientEmail = email;
                String subject = "Welcome to Park Smart";
                String body = "Hello " + fullName + ",<br>You have used this email to sign up to Park Smart.<br><br>Regards,<br>Park Smart Team";
                
                Properties properties = System.getProperties();
                properties.setProperty("mail.smtp.host", "smtp.gmail.com");
                properties.setProperty("mail.smtp.port", "587");
            }
            }
        
            catch(Exception e)
            { System.out.println(e);
            }
          %>